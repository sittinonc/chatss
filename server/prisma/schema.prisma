// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DB_URL")
}

model User {
  user_id      String  @id @default(uuid())
  name         String
  username     String  @unique
  hashed_password     String
  salt         String
  profile_image String?
  chatsA       Chat[]  @relation("UserA")
  chatsB       Chat[]  @relation("UserB")
  messagesSent Message[] @relation("Sender")
  messagesReceived Message[] @relation("Receiver")
}

model Chat {
  chat_id   String  @id @default(uuid())
  userA_id  String
  userB_id  String
  userA     User    @relation("UserA", fields: [userA_id], references: [user_id])
  userB     User    @relation("UserB", fields: [userB_id], references: [user_id])
  created_at DateTime @default(now())
  messages  Message[]
}

model MessageType {
  message_type_id String  @id @default(uuid())
  type_name       String
  messages        Message[]
}

model Message {
  message_id      String    @id @default(uuid())
  chat_id         String
  sender_id       String
  receiver_id     String
  message_type_id String
  content         String
  created_at       DateTime  @default(now())
  chat            Chat      @relation(fields: [chat_id], references: [chat_id])
  sender          User      @relation("Sender", fields: [sender_id], references: [user_id])
  receiver        User      @relation("Receiver", fields: [receiver_id], references: [user_id])
  message_type    MessageType @relation(fields: [message_type_id], references: [message_type_id])
}

